<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Power Calculation for the Cochran-Mantel-Haenszel Test • samplesizeCMH</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Power Calculation for the Cochran-Mantel-Haenszel Test">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">samplesizeCMH</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/samplesizeCMH-introduction.html">Introduction to the Cochran-Mantel-Haenszel Test</a>
    </li>
    <li>
      <a href="../articles/samplesizeCMH-power.html">Power Calculation for the Cochran-Mantel-Haenszel Test</a>
    </li>
    <li>
      <a href="../articles/samplesizeCMH-samplesize.html">Sample Size Calculation for the Cochran-Mantel-Haenszel Test</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SpectrumHealthResearch/samplesizeCMH">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Power Calculation for the Cochran-Mantel-Haenszel Test</h1>
                        <h4 class="author">Paul W. Egeler, M.S., GStat</h4>
            
            <h4 class="date">2019-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SpectrumHealthResearch/samplesizeCMH/blob/master/vignettes/samplesizeCMH-power.Rmd"><code>vignettes/samplesizeCMH-power.Rmd</code></a></small>
      <div class="hidden name"><code>samplesizeCMH-power.Rmd</code></div>

    </div>

    
    
<div id="calculating-post-hoc-power" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-post-hoc-power" class="anchor"></a>Calculating <em>post hoc</em> Power</h2>
<div id="the-data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#the-data-set" class="anchor"></a>The Data Set</h3>
<p>We will use the <code class="sourceCode r">Titanic</code> dataset in the <code class="sourceCode r">datasets</code> package to demonstrate a <em>post hoc</em> power calculation. This dataset is explored in greater detail in the <a href="samplesizeCMH-introduction.html">introductory vignette</a>.</p>
<p>Let <span class="math inline">\(X\)</span> = sex, <span class="math inline">\(Y\)</span> = survival, and <span class="math inline">\(Z\)</span> = class. Just as was performed in the introductory vignette, we will load the data and then create a set of partial tables stratified at fixed levels of class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(Titanic, <span class="dt">package =</span> <span class="st">"datasets"</span>)
partial_tables &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/margin.table.html">margin.table</a></span>(Titanic, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">1</span>))
<span class="kw"><a href="https://rdrr.io/r/stats/ftable.html">ftable</a></span>(partial_tables)</code></pre></div>
<pre><code>##                 Class 1st 2nd 3rd Crew
## Sex    Survived                       
## Male   No             118 154 422  670
##        Yes             62  25  88  192
## Female No               4  13 106    3
##        Yes            141  93  90   20</code></pre>
</div>
<div id="the-test-statistic" class="section level3">
<h3 class="hasAnchor">
<a href="#the-test-statistic" class="anchor"></a>The Test Statistic</h3>
<p>Performing a CMH test on the partial tables above shows that there is strong evidence that the common odds ratio is greater than one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/stats/mantelhaen.test.html">mantelhaen.test</a></span>(partial_tables)</code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  partial_tables
## Mantel-Haenszel X-squared = 360.33, df = 1, p-value &lt; 2.2e-16
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##   8.232629 14.185153
## sample estimates:
## common odds ratio 
##          10.80653</code></pre>
</div>
<div id="the-power-calculation" class="section level3">
<h3 class="hasAnchor">
<a href="#the-power-calculation" class="anchor"></a>The Power Calculation</h3>
<p>Using the <code class="sourceCode r"><span class="kw">power.cmh.test</span>()</code> function, we may calculate the probability that our rejection of the null hypothesis is a true result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(samplesizeCMH)

<span class="kw"><a href="../reference/power.cmh.test.html">power.cmh.test</a></span>(
  <span class="dt">p1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(partial_tables, <span class="dv">3</span>, prop.table, <span class="dv">2</span>)[<span class="dv">1</span>,],
  <span class="dt">p2 =</span> <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(partial_tables, <span class="dv">3</span>, prop.table, <span class="dv">2</span>)[<span class="dv">3</span>,],
  <span class="dt">N =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(Titanic),
  <span class="dt">power =</span> <span class="ot">NULL</span>,
  <span class="dt">s =</span> <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(partial_tables[,<span class="dv">1</span>,],<span class="dv">2</span>,sum) /<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(partial_tables,<span class="dv">3</span>,sum),
  <span class="dt">t =</span> <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(partial_tables, <span class="dv">3</span>, sum) /<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(Titanic)
)</code></pre></div>
<pre><code>## NOTE: Effect size ('theta') is not consistent between strata.</code></pre>
<pre><code>## Power and sample size calculation for the Cochran Mantel Haenszel test
## 
##                  N = 2201
##        Effective N = 2201
## Significance level = 0.05
##              Power = 1
##        Alternative = two.sided
## 
## Number of subjects per each group:
## ______________________________________
## Group   |     1      2      3      4 
## ======================================
## Case    |   122    167    528    673 
## Control |   203    118    178    212 
## 
## CALL: 
## power.cmh.test(p1 = apply(partial_tables, 3, prop.table, 2)[1, 
##     ], p2 = apply(partial_tables, 3, prop.table, 2)[3, ], N = sum(Titanic), 
##     power = NULL, s = apply(partial_tables[, 1, ], 2, sum)/apply(partial_tables, 
##         3, sum), t = apply(partial_tables, 3, sum)/sum(Titanic))</code></pre>
<p>Perhaps unsurprisingly, the power of this test approaches 100%.</p>
</div>
</div>
<div id="power-and-effect-size-in-a-negative-result" class="section level2">
<h2 class="hasAnchor">
<a href="#power-and-effect-size-in-a-negative-result" class="anchor"></a>Power and Effect Size in a Negative Result</h2>
<p>It does not make sense to calculate power in a study when the null hypothesis is not rejected. However, it may be of interest to the researcher to determine the minimum effect size that could be detected, given the sample size of the study and a specified power. We use the example of the Nurses’ Health Study explored by <span class="citation">Munoz and Rosner (1984)</span>. This study looked for a link between oral contraceptives and breast cancer, stratified by age <span class="citation">(Barton et al. 1980; Hennekens et al. 1984)</span>. The data for this illustration has been included in the <code>samplesizeCMH</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(contraceptives, <span class="dt">package =</span> <span class="st">"samplesizeCMH"</span>)
<span class="kw"><a href="https://rdrr.io/r/stats/ftable.html">ftable</a></span>(contraceptives)</code></pre></div>
<pre><code>##                            Age Group &lt;= 34 35 - 39 40 - 44 45 - 49 50 - 55
## OC Usage    Disease Status                                                
## Exposed     Case                        31      57      69      86      30
##             Control                    363     521     760     725     272
## Not Exposed Case                        40     107     196     241     132
##             Control                    327    1146    1914    2503    1370</code></pre>
<p>Here, as shown in <span class="citation">Hennekens et al. (1984)</span>, the Mantel-Haenszel test shows non-significant results, with the common odds ratio approximately equal to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/stats/mantelhaen.test.html">mantelhaen.test</a></span>(contraceptives)</code></pre></div>
<pre><code>## 
##  Mantel-Haenszel chi-squared test with continuity correction
## 
## data:  contraceptives
## Mantel-Haenszel X-squared = 0.33106, df = 1, p-value = 0.565
## alternative hypothesis: true common odds ratio is not equal to 1
## 95 percent confidence interval:
##  0.902928 1.214722
## sample estimates:
## common odds ratio 
##          1.047285</code></pre>
<p>The question now is what effect size would be detectable if an effect truly did exist in the data. That is to say, what effect size were we prepared to correctly detect given our data and specified significance level and power? We may vectorize the <code class="sourceCode r"><span class="kw">power.cmh.test</span>()</code> function to test a wide range of effect sizes to see where the effect size crosses over into adequate power.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vpower &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span>(power.cmh.test, <span class="st">"theta"</span>, <span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>)

thetas &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1.05</span>,<span class="fl">1.5</span>,<span class="fl">0.05</span>)

power_list &lt;-<span class="st"> </span><span class="kw">vpower</span>(
  <span class="dt">theta =</span> thetas,
  <span class="dt">p2 =</span> contraceptives[<span class="dv">1</span>,<span class="dv">2</span>,] /<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(contraceptives[,<span class="dv">2</span>,],<span class="dv">2</span>,sum),
  <span class="dt">N =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(contraceptives),
  <span class="dt">power =</span> <span class="ot">NULL</span>,
  <span class="dt">s =</span> <span class="dv">1</span>/<span class="dv">11</span>,
  <span class="dt">t =</span> <span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(contraceptives, <span class="dv">3</span>, sum) /<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(contraceptives),
  <span class="dt">alternative =</span> <span class="st">"greater"</span>
)

powers &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(power_list, <span class="st">"[["</span>, <span class="st">"power"</span>)

<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(powers) &lt;-<span class="st"> </span>thetas

powers</code></pre></div>
<pre><code>##      1.05       1.1      1.15       1.2      1.25       1.3      1.35 
## 0.1507626 0.3399285 0.5718383 0.7734926 0.9027666 0.9659347 0.9901502 
##       1.4      1.45       1.5 
## 0.9976178 0.9995114 0.9999139</code></pre>
<p>Using the data above, we may create a power curve.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">y =</span> powers, <span class="dt">x =</span> thetas, <span class="dt">main =</span> <span class="st">"Power curve as a function of effect size"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="fl">0.95</span>, <span class="dt">col =</span> <span class="st">"gold"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="fl">0.90</span>, <span class="dt">col =</span> <span class="st">"red"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="fl">0.80</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)

<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(
  <span class="st">"bottomright"</span>, 
  <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"95%"</span>, <span class="st">"90%"</span>, <span class="st">"80%"</span>), 
  <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gold"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>),
  <span class="dt">bty =</span> <span class="st">"n"</span>,
  <span class="dt">lty =</span> 1L,
  <span class="dt">title =</span> <span class="st">"Power level"</span>
  )</code></pre></div>
<p><img src="samplesizeCMH-power_files/figure-html/contraceptives-plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As we can see from above, 90% power would have been achieved if the common odds ratio was estimated to be approximately 1.25.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Barton1980">
<p>Barton, J., C. Bain, C. H. Hennekens, B. Rosner, C. Belanger, A. Roth, and F. E. Speizer. 1980. “Characteristics of Respondents and Non-Respondents to a Mailed Questionnaire.” <em>American Journal of Public Health</em> 70 (8): 823–25. <a href="http://www.ncbi.nlm.nih.gov/pubmed/7416342" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/7416342</a>.</p>
</div>
<div id="ref-Hennekens1984">
<p>Hennekens, C. H., F. E. Speizer, R. J. Lipnick, B. Rosner, C. Bain, C. Belanger, M. J. Stampfer, W. Willett, and R. Peto. 1984. “A Case-Control Study of Oral Contraceptive Use and Breast Cancer.” <em>Journal of the National Cancer Institute</em> 72 (1): 39–42. <a href="http://www.ncbi.nlm.nih.gov/pubmed/6363789" class="uri">http://www.ncbi.nlm.nih.gov/pubmed/6363789</a>.</p>
</div>
<div id="ref-Munoz1984">
<p>Munoz, A., and B. Rosner. 1984. “Power and Sample Size for a Collection of 2 X 2 Tables.” <em>Biometrics</em> 40 (4). Wiley-Blackwell: 995–1004.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#calculating-post-hoc-power">Calculating <em>post hoc</em> Power</a></li>
      <li><a href="#power-and-effect-size-in-a-negative-result">Power and Effect Size in a Negative Result</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Egeler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
